<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Confirma√ß√£o</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>

  <!-- Espa√ßo para o menu -->
  <div style="height: 50px;"></div>

  <!-- Menu fixo -->
  <header class="topo-fixo" id="menu-fixo">
    <div class="menu-container">
      <!-- √çcones √† esquerda (mobile) -->
      <div class="menu-esquerda mobile-apenas">
        <button class="menu-hamburguer" onclick="toggleMenu()">‚ò∞</button>
        <a href="buscar.html" class="btn-pesquisa" title="Pesquisar">
          <i class="fas fa-search"></i>
        </a>
      </div>

      <!-- Logo Desktop -->
      <div class="logo-titulo desktop-apenas">
        <a href="index.html">
          <img src="logo.png" alt="Logo" class="logo-site" />
        </a>
        <div class="titulos">
          <h1>UNIVERSO DA PRATA</h1>
          <h2 class="submarca">Joel Pratarias</h2>
        </div>
      </div>

      <!-- Logo Mobile -->
      <div class="logo-titulo mobile-apenas">
        <a href="index.html">
          <img src="logo.png" alt="Logo" class="logo-site" />
        </a>
        <div class="titulos">
          <h1>UNIVERSO DA PRATA</h1>
          <h2 class="submarca">Joel Pratarias</h2>
        </div>
      </div>

      <!-- √çcone carrinho (mobile) -->
      <div class="menu-direita mobile-apenas">
        <a href="carrinho.html" class="btn-carrinho" title="Carrinho">
          <i class="fas fa-shopping-bag"></i>
          <span class="carrinho-count">0</span>
        </a>
      </div>

      <!-- Menu lateral -->
      <nav class="menu-navegacao mobile-escondido">
        <a href="index.html">üè†In√≠cio</a>
        <a href="categorias.html">üàÅCategorias</a>
        <a href="promocoes.html">üéÅPromo√ß√µes</a>
        <a href="sobre.html">‚ÑπÔ∏èSobre N√≥s</a>
        <a href="contato.html">üìûContato</a>
        <a href="buscar.html">üîçBuscar</a>
        <a href="carrinho.html">üõíCarrinho <span class="carrinho-count">0</span></a>
      </nav>
    </div>
  </header>

  <main class="confirmacao-container">
    <h1>Confirmar Compra</h1>

    <div id="resumo-produtos"></div>

    <form id="form-confirmacao">
      <label for="nome">Nome Completo:</label>
      <input type="text" id="nome" name="nome" required />

      <label for="whatsapp">WhatsApp:</label>
      <input type="tel" id="whatsapp" name="whatsapp" required placeholder="Ex: +244923000000" />

      <label for="endereco">Endere√ßo de Entrega:</label>
      <textarea id="endereco" name="endereco" required></textarea>

      <label for="dataEntrega">Data Desejada para Entrega:</label>
      <input type="date" id="dataEntrega" name="dataEntrega" required />

      <label for="pagamento">Forma de Pagamento:</label>
      <select id="pagamento" name="pagamento" required>
        <option value="">-- Selecione --</option>
        <option value="Cash">Cash (em dinheiro)</option>
        <option value="Express">Express</option>
        <option value="Transfer√™ncia">Transfer√™ncia Banc√°ria</option>
      </select>

      <p style="margin-top: 10px; color: #555; font-style: italic;">
        ‚ö†Ô∏è S√≥ recebemos o pagamento total depois da entrega.
      </p>
      <div id="mensagem-erro" style="color: red; margin-top: 10px; font-weight: bold;"></div>
      <button type="button" onclick="enviarPedidoWhatsApp()">Confirmar Pedido</button>
    </form>
  </main>
  
  <!-- Preenche o resumo -->
  <script>
    const produtos = JSON.parse(localStorage.getItem("carrinho")) || [];
    const resumo = document.getElementById("resumo-produtos");
    let lista = "<h2>Resumo da Compra:</h2><ul>";
    let total = 0;

    produtos.forEach(p => {
      lista += `<li>${p.nome} - ${p.preco}</li>`;
      const valor = parseFloat(p.preco.replace(/[^\d,]/g, '').replace(',', '.'));
      total += valor;
    });

    lista += `</ul><p><strong>Total:</strong> AKZ ${total.toLocaleString("pt-AO", { minimumFractionDigits: 2 })}</p>`;
    resumo.innerHTML = lista;
  </script>

<script>
function enviarPedidoWhatsApp() {
  const nome = document.getElementById('nome').value.trim();
  const endereco = document.getElementById('endereco').value.trim();
  const telefone = document.getElementById('whatsapp').value.trim();
  const dataEntrega = document.getElementById('dataEntrega').value.trim();
  const pagamento = document.getElementById('pagamento').value.trim();

  const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
  const mensagemErro = document.getElementById("mensagem-erro");
  mensagemErro.innerHTML = ""; // limpa mensagens anteriores

  const erros = [];

  if (nome.length < 3) {
    erros.push("Nome inv√°lido (m√≠nimo 3 caracteres).");
  }

  if (!telefone.match(/^(\+244)?9\d{8}$/)) {
    erros.push("N√∫mero do WhatsApp inv√°lido. Ex: +244923000000");
  }

  if (endereco.length < 5) {
    erros.push("Endere√ßo de entrega incompleto.");
  }

  if (!dataEntrega) {
    erros.push("Data de entrega n√£o selecionada.");
  }

  if (!pagamento) {
    erros.push("Selecione a forma de pagamento.");
  }

  if (carrinho.length === 0) {
    erros.push("Seu carrinho est√° vazio.");
  }

  if (erros.length > 0) {
    mensagemErro.innerHTML = erros.map(e => `‚Ä¢ ${e}`).join("<br>");
    return;
  }

  // üîπ C√≥digo EmailJS - somente se n√£o houver erros üîπ
  const templateParams = {
    nome: nome,
    telefone: telefone,
    endereco: endereco,
    dataEntrega: dataEntrega,
    pagamento: pagamento,
    itens: carrinho.map(item => `${item.nome} - ${item.preco}`).join("\n")
  };

  emailjs.send('service_us6no95', 'template_kk6zokl', templateParams)
    .then(function(response) {
      console.log('Pedido enviado com sucesso!', response.status, response.text);
    }, function(error) {
      console.log('Falha ao enviar o pedido...', error);
      mensagemErro.innerHTML = "Erro ao enviar o pedido. Por favor, tente novamente.";
    });

  // Monta a mensagem WhatsApp
  let mensagem = `üõçÔ∏è *Confirma√ß√£o de Pedido - Universo da Prata* üõçÔ∏è\n\n`;
  mensagem += `üë§ *Nome:* ${nome}\n`;
  mensagem += `üìç *Endere√ßo:* ${endereco}\n`;
  mensagem += `üìû *Telefone:* ${telefone}\n`;
  mensagem += `üìÖ *Data de Entrega:* ${dataEntrega}\n`;
  mensagem += `üí≥ *Forma de Pagamento:* ${pagamento}\n\n`;
  mensagem += `üì¶ *Itens do Carrinho:*\n`;

  carrinho.forEach((item) => {
    mensagem += `‚Ä¢ ${item.nome} - ${item.preco}\n`;
  });

  mensagem += `\nüìù *Observa√ß√£o:* Pagamento apenas ap√≥s a entrega.\n`;
  mensagem += `\nAguarde nosso contato para confirma√ß√£o do envio.`;

  // Envia para WhatsApp
  const url = `https://wa.me/244934803197?text=${encodeURIComponent(mensagem)}`;
  window.open(url, '_blank');

  // Limpa o carrinho
  localStorage.removeItem('carrinho');

  // Redireciona (opcional)
  setTimeout(() => {
    window.location.href = "obrigado.html";
  }, 1000);
}
</script>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  emailjs.init("3tODf0cATd2J3nsCZ"); // sua Public Key
</script>

  <!-- Menu responsivo -->
  <script>
    function toggleMenu() {
      const menu = document.querySelector('.menu-navegacao');
      menu.classList.toggle('mobile-escondido');
      menu.classList.toggle('mobile-visivel');
    }

    function ajustarMenuParaTamanhoTela() {
      const menu = document.querySelector('.menu-navegacao');
      if (window.innerWidth > 768) {
        menu.classList.remove('mobile-escondido', 'mobile-visivel');
      } else {
        menu.classList.add('mobile-escondido');
      }
    }

    window.addEventListener('load', ajustarMenuParaTamanhoTela);
    window.addEventListener('resize', ajustarMenuParaTamanhoTela);
  </script>
  
  <!-- Estrelas flutuantes -->
  <script>
    const starsContainer = document.getElementById("stars-container");
    for (let i = 0; i < 100; i++) {
      const star = document.createElement("div");
      star.className = "star";
      star.style.left = `${Math.random() * 100}%`;
      star.style.top = `${Math.random() * 100}%`;
      star.style.animationDuration = `${5 + Math.random() * 10}s`;
      star.style.opacity = Math.random();
      starsContainer.appendChild(star);
    }
  </script>

  <script>
    // Atualizar o contador do carrinho
    document.addEventListener('DOMContentLoaded', () => {
      const todosContadores = document.querySelectorAll('.carrinho-count');
      const carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];
      const total = carrinho.reduce((sum, item) => sum + (item.quantidade || 1), 0);
      todosContadores.forEach(span => {
        span.textContent = total;
      });

      const pontoHamburguer = document.getElementById('notificacaoHamburguer');
      if (pontoHamburguer) {
        pontoHamburguer.style.display = total > 0 ? 'block' : 'none';
      }
    });
  </script>

  <footer>
    <div class="social">
      <h3>Visite e sinta-se especial nas nossas redes</h3>
      <div class="social-icons">
        <a href="https://www.instagram.com/universodaprata.joelpratarias/" target="_blank"><img src="instagram.png" alt="Instagram"></a>
        <a href="https://www.facebook.com/profile.php?id=100067343702649" target="_blank"><img src="facebook.png" alt="Facebook"></a>
        <a href="#"><img src="tiktok.png" alt="TikTok"></a>
        <a href="#"><img src="x.png" alt="X"></a>
      </div>
    </div>
    <p style="margin-top: 20px;">&copy; 2026 Universo da Prata. Todos os direitos reservados.</p>
  </footer>

</body>
</html>
